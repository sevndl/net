@page "/ajoutFacture"

@using Facturations.Shared

@inject HttpClient http
@inject NavigationManager nm

<h1>Ajout d'une facture</h1>

<EditForm EditContext="@context" OnSubmit="@HandleSubmit">
  <DataAnnotationsValidator />
  <div>
    <label for="NewClient">Client</label>
    <InputText id="NewClient" @bind-Value="@NewFacture.client" />
    <ValidationMessage For="@(() => NewFacture.client)" />
  </div>
  <div>
    <label for="NewReference">Référence</label>
    <InputText id="NewReference" @bind-Value="@NewFacture.reference" />
    <ValidationMessage For="@(() => NewFacture.reference)" />
  </div>
  <div>
    <label for="NewDateEmission">Date d'émission</label>
    <InputDate id="NewDateEmission" @bind-Value="@NewFacture.dateEmission" />
    <ValidationMessage For="@(() => NewFacture.dateEmission)" />
  </div>
  <div>
    <label for="NewDateReglementAttendu">Date attendue pour le règlement</label>
    <InputDate id="NewDateReglementAttendu" @bind-Value="@NewFacture.dateReglementAttendu" />
    <ValidationMessage For="@(() => NewFacture.dateReglementAttendu)" />
  </div>
  <div>
    <label for="NewMontantDu">Montant dû</label>
    <InputNumber id="NewMontantDu" @bind-Value="@NewFacture.montantDu" />
    <ValidationMessage For="@(() => NewFacture.montantDu)" />
  </div>
  <div>
    <label for="NewMontantRegle">Montant réglé</label>
    <InputNumber id="NewMontantRegle" @bind-Value="@NewFacture.montantRegle" />
    <ValidationMessage For="@(() => NewFacture.montantRegle)" />
  </div>
  <div>
    <button type="submit">Créer facture</button>
  </div>
</EditForm>

@code {
  Facture NewFacture = new Facture();
  EditContext context;

  protected override Task OnInitializedAsync()
  {
    context = new EditContext(NewFacture);
    return base.OnInitializedAsync();
  }

  private async Task HandleSubmit(EditContext context)
  {
    if (context.Validate())
    {
      await http.PostAsJsonAsync("api/factures", NewFacture);
      nm.NavigateTo("/tableauDeBord");
    }
  }
}